# StrikeScale: –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–î–∞—Ç–∞:** 17.10.2025  
**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** –≠—Ç–∞–ø 1 –∑–∞–≤–µ—Ä—à–µ–Ω ‚úÖ

---

## üìç –ì–î–ï –ú–´ –°–ï–ô–ß–ê–°

- ‚úÖ **–≠—Ç–∞–ø 1:** –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–µ—Ä—Å–∏—è —Å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–º–∏
- ‚è≥ **–≠—Ç–∞–ø 2:** –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (—Å–ª–µ–¥—É—é—â–∏–π)
- ‚è≥ **–≠—Ç–∞–ø 3:** –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- ‚è≥ **–≠—Ç–∞–ø 4:** –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- ‚è≥ **–≠—Ç–∞–ø 5:** –ü–æ–ª–∏—Ä–æ–≤–∫–∞

---

## üöÄ –≠–¢–ê–ü 2: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ

### –¶–µ–ª—å
–ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `positions` –∏ `options`

### –ó–∞–¥–∞—á–∏

#### 2.1. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ positions ‚Üí flags ‚è≥
**–§–∞–π–ª:** `StrikeScale.jsx`

**–ß—Ç–æ –¥–µ–ª–∞–µ–º:**
```javascript
const flags = useMemo(() => {
  return positions
    .filter(pos => isTopFlag(pos))
    .map(pos => ({
      id: pos.id,
      price: pos.strike,
      color: calculateFlagColor(pos),
      count: pos.quantity,
      date: pos.date,
      dateColor: calculateDateColor(pos),
      type: 'option'
    }));
}, [positions]);
```

**–§—É–Ω–∫—Ü–∏–∏:**
- `isTopFlag(position)` - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ñ–ª–∞–≥–∞
- `calculateFlagColor(position)` - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ü–≤–µ—Ç —Ñ–ª–∞–≥–∞
- `calculateDateColor(position)` - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ü–≤–µ—Ç –±–µ–π–¥–∂–∞ –¥–∞—Ç—ã

---

#### 2.2. –†–∞—Å—á–µ—Ç –≤—ã—Å–æ—Ç—ã —Å—Ç–æ–ª–±–∏–∫–æ–≤ ‚è≥
**–ß—Ç–æ –¥–µ–ª–∞–µ–º:**
```javascript
const { greenBarHeights, redBarHeights } = useMemo(() => {
  // –ù–∞–π—Ç–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π OI –¥–ª—è CALL –∏ PUT
  const maxCallOI = Math.max(...options
    .filter(opt => opt.type === 'CALL')
    .map(opt => opt.oi || 0)
  );
  
  // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –≤—ã—Å–æ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç—Ä–∞–π–∫–∞
  const greenHeights = Array(211).fill(0);
  options
    .filter(opt => opt.type === 'CALL')
    .forEach(opt => {
      const index = opt.strike - 5100;
      greenHeights[index] = (opt.oi / maxCallOI) * 30;
    });
  
  // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è PUT...
  
  return { greenBarHeights: greenHeights, redBarHeights: redHeights };
}, [options]);
```

---

#### 2.3. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–π –ø–æ —Å—Ç—Ä–∞–π–∫–∞–º ‚è≥
**–ß—Ç–æ –¥–µ–ª–∞–µ–º:**
```javascript
// –ï—Å–ª–∏ –Ω–∞ –æ–¥–Ω–æ–º —Å—Ç—Ä–∞–π–∫–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–∑–∏—Ü–∏–π
const groupedPositions = positions.reduce((acc, pos) => {
  const key = `${pos.strike}-${pos.type}-${pos.action}`;
  if (!acc[key]) {
    acc[key] = { ...pos, quantity: 0 };
  }
  acc[key].quantity += pos.quantity;
  return acc;
}, {});
```

---

#### 2.4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–ª–∞–≥–∞ —Ç–∏–∫–µ—Ä–∞ ‚è≥
**–ß—Ç–æ –¥–µ–ª–∞–µ–º:**
```javascript
// –§–ª–∞–≥ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã
if (currentPrice > 0) {
  flags.push({
    id: 'ticker',
    price: Math.round(currentPrice),
    color: 'rgb(75, 85, 99)',
    label: ticker || 'SPX',
    type: 'ticker'
  });
}
```

---

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≠—Ç–∞–ø–∞ 2
- [ ] –§–ª–∞–≥–∏ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ `positions`
- [ ] –°—Ç–æ–ª–±–∏–∫–∏ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ `options`
- [ ] –§–ª–∞–≥ —Ç–∏–∫–µ—Ä–∞ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ `currentPrice`
- [ ] –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã (–Ω–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞)

---

## üéØ –≠–¢–ê–ü 3: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

### –ó–∞–¥–∞—á–∏

#### 3.1. Drag & Drop —Ñ–ª–∞–≥–æ–≤ ‚è≥
- `onMouseDown` - –Ω–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
- `onMouseMove` - –¥–≤–∏–∂–µ–Ω–∏–µ —Ñ–ª–∞–≥–∞
- `onMouseUp` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ, –≤—ã–∑–æ–≤ callback

#### 3.2. –°–∏—Å—Ç–µ–º–∞ —É—Ä–æ–≤–Ω–µ–π –Ω–∞–ª–æ–∂–µ–Ω–∏—è ‚è≥
- –†–∞—Å—á–µ—Ç Y-levels –¥–ª—è —Ñ–ª–∞–≥–æ–≤
- –ú–∞–∫—Å–∏–º—É–º 4 —É—Ä–æ–≤–Ω—è (0-3)

#### 3.3. –£–º–Ω–æ–µ –ø—Ä–∏–ª–∏–ø–∞–Ω–∏–µ ‚è≥
- –ü—Ä–∏–ª–∏–ø–∞–Ω–∏–µ –∫ –∫—Ä—É–≥–ª—ã–º —á–∏—Å–ª–∞–º
- –ü—Ä–∏–ª–∏–ø–∞–Ω–∏–µ –∫ —Å—Ç—Ä–∞–π–∫–∞–º —Å –≤—ã—Å–æ–∫–∏–º OI
- –ü—Ä–∏–ª–∏–ø–∞–Ω–∏–µ –∫ breakeven

#### 3.4. Callback onPositionChange ‚è≥
- –í—ã–∑–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—è

---

## ‚ö° –≠–¢–ê–ü 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –ó–∞–¥–∞—á–∏

#### 4.1. –ú–µ–º–æ–∏–∑–∞—Ü–∏—è ‚è≥
- `useMemo` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ñ–ª–∞–≥–æ–≤
- `useMemo` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–ª–±–∏–∫–æ–≤
- `React.memo` –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

#### 4.2. P&L Zones ‚è≥
- –†–∞—Å—á–µ—Ç –∑–æ–Ω –ø—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–∞
- –¶–≤–µ—Ç–Ω–æ–π —Ñ–æ–Ω –Ω–∞ —à–∫–∞–ª–µ

#### 4.3. Market Sentiment ‚è≥
- –ú–µ—Ç–∫–∏ Hot Strikes (üî•)
- –ú–µ—Ç–∫–∏ High Volume (‚ö°)

---

## üé® –≠–¢–ê–ü 5: –ü–æ–ª–∏—Ä–æ–≤–∫–∞

### –ó–∞–¥–∞—á–∏

#### 5.1. Tooltips ‚è≥
- –î–µ—Ç–∞–ª–∏ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏

#### 5.2. –ú–∏–Ω–∏-–≥—Ä–∞—Ñ–∏–∫ P&L ‚è≥
- SVG –∫—Ä–∏–≤–∞—è –ø–æ–≤–µ—Ä—Ö —Å—Ç–æ–ª–±–∏–∫–æ–≤

#### 5.3. –ê–Ω–∏–º–∞—Ü–∏–∏ ‚è≥
- Transition –¥–ª—è —Ñ–ª–∞–≥–æ–≤

---

## üìù –¢–ï–ö–£–©–ò–ï –ó–ê–î–ê–ß–ò

### –°–µ–π—á–∞—Å –Ω—É–∂–Ω–æ:
1. ‚úÖ –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ 4 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞
2. ‚è≥ –ù–∞—á–∞—Ç—å –≠—Ç–∞–ø 2.1 (–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ positions ‚Üí flags)
3. ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é —Ñ—É–Ω–∫—Ü–∏—é –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏

### –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:
**–°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≠—Ç–∞–ø–∞ 2.1:**
- `isTopFlag(position)`
- `calculateFlagColor(position)`
- `calculateDateColor(position)`

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- **–¢–ó:** `_docs/STRIKE_SCALE_TZ.md`
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** `_docs/STRIKE_SCALE_FIXES.md`
- **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:** `_docs/STRIKE_SCALE_INTERACTIONS.md`
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** `frontend/src/components/CalculatorV2/StrikeScale.jsx`

---

**–ì–æ—Ç–æ–≤ –Ω–∞—á–∏–Ω–∞—Ç—å –≠—Ç–∞–ø 2?** üöÄ
