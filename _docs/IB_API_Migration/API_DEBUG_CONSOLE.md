# üîç API Debug Console - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è IB API

**–¶–µ–ª—å:** –í–∏–∑—É–∞–ª—å–Ω–∞—è –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ IB API –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–æ—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫—É –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

---

## üí° –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–ú–∞–ª–µ–Ω—å–∫–æ–µ –æ–∫–æ—à–∫–æ (–∫–æ–Ω—Å–æ–ª—å), –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- ‚úÖ –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- ‚úÖ –¢–∏–ø —Å–æ–±—ã—Ç–∏—è/–∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ –°—Ç–∞—Ç—É—Å (—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞)
- ‚úÖ –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚úÖ –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö

**–í–∏–∑—É–∞–ª—å–Ω–æ:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üîç IB API Debug Console                    [√ó] ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 10:15:23 ‚úÖ GET_STOCK_PRICE                     ‚îÇ
‚îÇ          ‚Üí Ticker: SPY                          ‚îÇ
‚îÇ          ‚Üê Price: $459.80 (120ms)               ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ 10:15:24 ‚úÖ GET_EXPIRATION_DATES                ‚îÇ
‚îÇ          ‚Üí Ticker: SPY                          ‚îÇ
‚îÇ          ‚Üê 45 dates loaded (850ms)              ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ 10:15:25 ‚úÖ GET_OPTIONS_CHAIN                   ‚îÇ
‚îÇ          ‚Üí SPY, 2025-10-31                      ‚îÇ
‚îÇ          ‚Üê 156 contracts (1.2s, 45KB)           ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ 10:15:26 ‚ùå GET_GREEKS                          ‚îÇ
‚îÇ          ‚Üí Contract: SPY251031C00450000         ‚îÇ
‚îÇ          ‚úó Error: No subscription (500ms)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### 1. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π**
–ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∫ IB API –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å –¥–µ—Ç–∞–ª—è–º–∏:

```javascript
{
  timestamp: "10:15:23",
  type: "GET_STOCK_PRICE",
  status: "success",
  request: {
    ticker: "SPY"
  },
  response: {
    price: 459.80,
    change: 2.30
  },
  duration: 120,  // ms
  dataSize: 256   // bytes
}
```

### 2. **–§–∏–ª—å—Ç—Ä—ã**
- –ü–æ —Ç–∏–ø—É —Å–æ–±—ã—Ç–∏—è (—Ü–µ–Ω—ã, –æ–ø—Ü–∏–æ–Ω—ã, Greeks, –∏ —Ç.–¥.)
- –ü–æ —Å—Ç–∞—Ç—É—Å—É (—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞)
- –ü–æ —Ç–∏–∫–µ—Ä—É
- –ü–æ –≤—Ä–µ–º–µ–Ω–∏

### 3. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ—Å—Å–∏—é             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤:        47           ‚îÇ
‚îÇ –£—Å–ø–µ—à–Ω—ã—Ö:              45 (95.7%)   ‚îÇ
‚îÇ –û—à–∏–±–æ–∫:                2  (4.3%)    ‚îÇ
‚îÇ –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å:      450ms        ‚îÇ
‚îÇ –û–±—â–∏–π —Ç—Ä–∞—Ñ–∏–∫:          2.3 MB       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 4. **–≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤**
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ JSON
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ CSV
- –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞

---

## üõ†Ô∏è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∫–æ–Ω—Å–æ–ª—å –≤ UI (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é)

**–ì–¥–µ:** –û—Ç–¥–µ–ª—å–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ –≤ Developer Tools –∏–ª–∏ –ø–ª–∞–≤–∞—é—â–µ–µ –æ–∫–Ω–æ

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- LocalStorage –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤

**–§–∞–π–ª—ã:**
```
/frontend/src/components/DebugConsole/
  ‚îú‚îÄ‚îÄ DebugConsole.jsx       # –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
  ‚îú‚îÄ‚îÄ EventLog.jsx           # –°–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π
  ‚îú‚îÄ‚îÄ EventDetails.jsx       # –î–µ—Ç–∞–ª–∏ —Å–æ–±—ã—Ç–∏—è
  ‚îú‚îÄ‚îÄ Filters.jsx            # –§–∏–ª—å—Ç—Ä—ã
  ‚îú‚îÄ‚îÄ Statistics.jsx         # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  ‚îî‚îÄ‚îÄ DebugConsole.css       # –°—Ç–∏–ª–∏
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: Standalone –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–û—Ç–¥–µ–ª—å–Ω–æ–µ –æ–∫–Ω–æ Electron –∏–ª–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**

**–ü–ª—é—Å—ã:**
- –ù–µ –∑–∞–≥—Ä–æ–º–æ–∂–¥–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π UI
- –ú–æ–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å –Ω–∞ –≤—Ç–æ—Ä–æ–º –º–æ–Ω–∏—Ç–æ—Ä–µ
- –ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ú–∏–Ω—É—Å—ã:**
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- –ù—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ª–æ–≥–æ–≤

---

## üìù –î–µ—Ç–∞–ª—å–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

### Backend: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤

**–°–æ–∑–¥–∞—Ç—å `/backend/app/utils/api_logger.py`:**

```python
"""
API Logger –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ IB API –∑–∞–ø—Ä–æ—Å–æ–≤
"""

import time
import json
from datetime import datetime
from typing import Dict, Any, Optional
from enum import Enum

class EventType(Enum):
    """–¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π API"""
    GET_STOCK_PRICE = "GET_STOCK_PRICE"
    GET_EXPIRATION_DATES = "GET_EXPIRATION_DATES"
    GET_OPTIONS_CHAIN = "GET_OPTIONS_CHAIN"
    GET_GREEKS = "GET_GREEKS"
    GET_HISTORICAL_DATA = "GET_HISTORICAL_DATA"
    PLACE_ORDER = "PLACE_ORDER"
    GET_POSITIONS = "GET_POSITIONS"
    WEBSOCKET_MESSAGE = "WEBSOCKET_MESSAGE"

class APILogger:
    """–õ–æ–≥–≥–µ—Ä –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤"""
    
    def __init__(self):
        self.events = []
        self.max_events = 1000  # –•—Ä–∞–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 1000 —Å–æ–±—ã—Ç–∏–π
    
    def log_event(
        self,
        event_type: EventType,
        request_data: Dict[str, Any],
        response_data: Optional[Dict[str, Any]] = None,
        error: Optional[str] = None,
        duration_ms: Optional[int] = None,
        data_size: Optional[int] = None
    ):
        """–ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ API"""
        
        event = {
            "id": len(self.events) + 1,
            "timestamp": datetime.now().isoformat(),
            "type": event_type.value,
            "status": "error" if error else "success",
            "request": request_data,
            "response": response_data,
            "error": error,
            "duration_ms": duration_ms,
            "data_size": data_size
        }
        
        self.events.append(event)
        
        # –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ª–æ–≥–∞
        if len(self.events) > self.max_events:
            self.events.pop(0)
        
        # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ WebSocket (–µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω)
        self._broadcast_event(event)
        
        return event
    
    def _broadcast_event(self, event: Dict):
        """–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ WebSocket"""
        # TODO: Implement WebSocket broadcast
        pass
    
    def get_events(
        self,
        event_type: Optional[str] = None,
        status: Optional[str] = None,
        limit: int = 100
    ):
        """–ü–æ–ª—É—á–∏—Ç—å —Å–æ–±—ã—Ç–∏—è —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏"""
        
        filtered = self.events
        
        if event_type:
            filtered = [e for e in filtered if e["type"] == event_type]
        
        if status:
            filtered = [e for e in filtered if e["status"] == status]
        
        return filtered[-limit:]
    
    def get_statistics(self):
        """–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"""
        
        total = len(self.events)
        success = len([e for e in self.events if e["status"] == "success"])
        errors = total - success
        
        durations = [e["duration_ms"] for e in self.events if e["duration_ms"]]
        avg_duration = sum(durations) / len(durations) if durations else 0
        
        data_sizes = [e["data_size"] for e in self.events if e["data_size"]]
        total_traffic = sum(data_sizes) if data_sizes else 0
        
        return {
            "total_requests": total,
            "successful": success,
            "errors": errors,
            "success_rate": (success / total * 100) if total > 0 else 0,
            "avg_duration_ms": round(avg_duration, 2),
            "total_traffic_bytes": total_traffic
        }
    
    def clear(self):
        """–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è"""
        self.events = []

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –ª–æ–≥–≥–µ—Ä–∞
api_logger = APILogger()
```

---

### –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–í —Ç–æ–º –∂–µ —Ñ–∞–π–ª–µ:**

```python
from functools import wraps
import sys

def log_api_call(event_type: EventType):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è API –≤—ã–∑–æ–≤–æ–≤"""
    
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            start_time = time.time()
            
            # –ò–∑–≤–ª–µ—á—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
            request_data = {
                "args": args[1:],  # –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å self
                "kwargs": kwargs
            }
            
            try:
                # –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é
                result = func(*args, **kwargs)
                
                # –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏
                duration_ms = int((time.time() - start_time) * 1000)
                data_size = sys.getsizeof(json.dumps(result)) if result else 0
                
                # –ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —É—Å–ø–µ—Ö
                api_logger.log_event(
                    event_type=event_type,
                    request_data=request_data,
                    response_data=result,
                    duration_ms=duration_ms,
                    data_size=data_size
                )
                
                return result
                
            except Exception as e:
                # –ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É
                duration_ms = int((time.time() - start_time) * 1000)
                
                api_logger.log_event(
                    event_type=event_type,
                    request_data=request_data,
                    error=str(e),
                    duration_ms=duration_ms
                )
                
                raise
        
        return wrapper
    return decorator
```

---

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ IB Client

**–û–±–Ω–æ–≤–∏—Ç—å `/backend/app/services/ib_client.py`:**

```python
from app.utils.api_logger import log_api_call, EventType

class IBClient:
    
    @log_api_call(EventType.GET_STOCK_PRICE)
    def get_stock_price(self, ticker: str) -> Dict:
        """–ü–æ–ª—É—á–∏—Ç—å —Ü–µ–Ω—É –∞–∫—Ü–∏–∏ (—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º)"""
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
        pass
    
    @log_api_call(EventType.GET_EXPIRATION_DATES)
    def get_expiration_dates(self, ticker: str) -> List[str]:
        """–ü–æ–ª—É—á–∏—Ç—å –¥–∞—Ç—ã —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏ (—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º)"""
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
        pass
    
    @log_api_call(EventType.GET_OPTIONS_CHAIN)
    def get_options_chain(self, ticker: str, expiration_date: str) -> List[Dict]:
        """–ü–æ–ª—É—á–∏—Ç—å –æ–ø—Ü–∏–æ–Ω–Ω—É—é —Ü–µ–ø–æ—á–∫—É (—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º)"""
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
        pass
```

---

### API Endpoints –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏

**–°–æ–∑–¥–∞—Ç—å `/backend/app/routers/debug.py`:**

```python
from fastapi import APIRouter, WebSocket
from app.utils.api_logger import api_logger

router = APIRouter(prefix="/api/debug", tags=["debug"])

@router.get("/events")
async def get_events(
    event_type: str = None,
    status: str = None,
    limit: int = 100
):
    """–ü–æ–ª—É—á–∏—Ç—å —Å–æ–±—ã—Ç–∏—è —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏"""
    events = api_logger.get_events(event_type, status, limit)
    return {"status": "success", "events": events}

@router.get("/statistics")
async def get_statistics():
    """–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"""
    stats = api_logger.get_statistics()
    return {"status": "success", "statistics": stats}

@router.delete("/events")
async def clear_events():
    """–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è"""
    api_logger.clear()
    return {"status": "success", "message": "Events cleared"}

@router.websocket("/ws")
async def websocket_endpoint(websocket: WebSocket):
    """WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π"""
    await websocket.accept()
    
    # TODO: Implement real-time event streaming
    try:
        while True:
            # –ñ–¥–∞—Ç—å –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∏—Ö
            await websocket.receive_text()
    except:
        pass
```

**–ü–æ–¥–∫–ª—é—á–∏—Ç—å –≤ `main.py`:**
```python
from app.routers import debug

app.include_router(debug.router)
```

---

### Frontend: Debug Console –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

**–°–æ–∑–¥–∞—Ç—å `/frontend/src/components/DebugConsole/DebugConsole.jsx`:**

```javascript
import React, { useState, useEffect } from 'react';
import './DebugConsole.css';

function DebugConsole({ isOpen, onClose }) {
  const [events, setEvents] = useState([]);
  const [statistics, setStatistics] = useState(null);
  const [filter, setFilter] = useState({
    type: 'all',
    status: 'all'
  });

  // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–±—ã—Ç–∏—è
  useEffect(() => {
    if (isOpen) {
      fetchEvents();
      fetchStatistics();
      
      // –û–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
      const interval = setInterval(() => {
        fetchEvents();
        fetchStatistics();
      }, 2000);
      
      return () => clearInterval(interval);
    }
  }, [isOpen, filter]);

  const fetchEvents = async () => {
    try {
      const params = new URLSearchParams();
      if (filter.type !== 'all') params.append('event_type', filter.type);
      if (filter.status !== 'all') params.append('status', filter.status);
      
      const response = await fetch(`/api/debug/events?${params}`);
      const data = await response.json();
      setEvents(data.events || []);
    } catch (error) {
      console.error('Error fetching events:', error);
    }
  };

  const fetchStatistics = async () => {
    try {
      const response = await fetch('/api/debug/statistics');
      const data = await response.json();
      setStatistics(data.statistics);
    } catch (error) {
      console.error('Error fetching statistics:', error);
    }
  };

  const clearEvents = async () => {
    try {
      await fetch('/api/debug/events', { method: 'DELETE' });
      setEvents([]);
      fetchStatistics();
    } catch (error) {
      console.error('Error clearing events:', error);
    }
  };

  const exportToJSON = () => {
    const dataStr = JSON.stringify(events, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `api-debug-${Date.now()}.json`;
    link.click();
  };

  if (!isOpen) return null;

  return (
    <div className="debug-console">
      <div className="console-header">
        <h3>üîç IB API Debug Console</h3>
        <button onClick={onClose} className="close-btn">√ó</button>
      </div>

      {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */}
      {statistics && (
        <div className="console-stats">
          <div className="stat-item">
            <span className="stat-label">–í—Å–µ–≥–æ:</span>
            <span className="stat-value">{statistics.total_requests}</span>
          </div>
          <div className="stat-item">
            <span className="stat-label">–£—Å–ø–µ—à–Ω—ã—Ö:</span>
            <span className="stat-value success">
              {statistics.successful} ({statistics.success_rate.toFixed(1)}%)
            </span>
          </div>
          <div className="stat-item">
            <span className="stat-label">–û—à–∏–±–æ–∫:</span>
            <span className="stat-value error">{statistics.errors}</span>
          </div>
          <div className="stat-item">
            <span className="stat-label">–°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å:</span>
            <span className="stat-value">{statistics.avg_duration_ms}ms</span>
          </div>
          <div className="stat-item">
            <span className="stat-label">–¢—Ä–∞—Ñ–∏–∫:</span>
            <span className="stat-value">
              {(statistics.total_traffic_bytes / 1024).toFixed(1)} KB
            </span>
          </div>
        </div>
      )}

      {/* –§–∏–ª—å—Ç—Ä—ã */}
      <div className="console-filters">
        <select 
          value={filter.type} 
          onChange={(e) => setFilter({...filter, type: e.target.value})}
        >
          <option value="all">–í—Å–µ —Ç–∏–ø—ã</option>
          <option value="GET_STOCK_PRICE">–¶–µ–Ω—ã –∞–∫—Ü–∏–π</option>
          <option value="GET_EXPIRATION_DATES">–î–∞—Ç—ã —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏</option>
          <option value="GET_OPTIONS_CHAIN">–û–ø—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞</option>
          <option value="GET_GREEKS">Greeks</option>
        </select>

        <select 
          value={filter.status} 
          onChange={(e) => setFilter({...filter, status: e.target.value})}
        >
          <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
          <option value="success">–£—Å–ø–µ—à–Ω—ã–µ</option>
          <option value="error">–û—à–∏–±–∫–∏</option>
        </select>

        <button onClick={clearEvents} className="btn-clear">
          üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
        </button>
        <button onClick={exportToJSON} className="btn-export">
          üíæ –≠–∫—Å–ø–æ—Ä—Ç
        </button>
      </div>

      {/* –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π */}
      <div className="console-events">
        {events.length === 0 ? (
          <div className="no-events">–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π</div>
        ) : (
          events.map((event) => (
            <div 
              key={event.id} 
              className={`event-item ${event.status}`}
            >
              <div className="event-header">
                <span className="event-time">
                  {new Date(event.timestamp).toLocaleTimeString()}
                </span>
                <span className={`event-status ${event.status}`}>
                  {event.status === 'success' ? '‚úÖ' : '‚ùå'}
                </span>
                <span className="event-type">{event.type}</span>
                <span className="event-duration">{event.duration_ms}ms</span>
              </div>
              
              <div className="event-details">
                <div className="event-request">
                  ‚Üí {JSON.stringify(event.request)}
                </div>
                {event.response && (
                  <div className="event-response">
                    ‚Üê {JSON.stringify(event.response).substring(0, 100)}...
                  </div>
                )}
                {event.error && (
                  <div className="event-error">
                    ‚úó {event.error}
                  </div>
                )}
              </div>
            </div>
          ))
        )}
      </div>
    </div>
  );
}

export default DebugConsole;
```

---

### CSS —Å—Ç–∏–ª–∏

**–°–æ–∑–¥–∞—Ç—å `/frontend/src/components/DebugConsole/DebugConsole.css`:**

```css
.debug-console {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 500px;
  max-height: 600px;
  background: #1e1e1e;
  color: #d4d4d4;
  border-radius: 8px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
  display: flex;
  flex-direction: column;
  font-family: 'Consolas', 'Monaco', monospace;
  font-size: 12px;
  z-index: 10000;
}

.console-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  background: #2d2d2d;
  border-bottom: 1px solid #3e3e3e;
  border-radius: 8px 8px 0 0;
}

.console-header h3 {
  margin: 0;
  font-size: 14px;
  font-weight: 600;
}

.close-btn {
  background: none;
  border: none;
  color: #d4d4d4;
  font-size: 20px;
  cursor: pointer;
  padding: 0;
  width: 24px;
  height: 24px;
}

.close-btn:hover {
  color: #ff6b6b;
}

.console-stats {
  display: flex;
  gap: 12px;
  padding: 12px 16px;
  background: #252525;
  border-bottom: 1px solid #3e3e3e;
  flex-wrap: wrap;
}

.stat-item {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.stat-label {
  font-size: 10px;
  color: #888;
  text-transform: uppercase;
}

.stat-value {
  font-size: 14px;
  font-weight: 600;
}

.stat-value.success {
  color: #4ade80;
}

.stat-value.error {
  color: #f87171;
}

.console-filters {
  display: flex;
  gap: 8px;
  padding: 12px 16px;
  background: #2d2d2d;
  border-bottom: 1px solid #3e3e3e;
}

.console-filters select,
.console-filters button {
  padding: 6px 12px;
  background: #3e3e3e;
  border: 1px solid #4e4e4e;
  color: #d4d4d4;
  border-radius: 4px;
  font-size: 11px;
  cursor: pointer;
}

.console-filters select:hover,
.console-filters button:hover {
  background: #4e4e4e;
}

.console-events {
  flex: 1;
  overflow-y: auto;
  padding: 8px;
}

.no-events {
  text-align: center;
  padding: 40px;
  color: #666;
}

.event-item {
  margin-bottom: 8px;
  padding: 8px;
  background: #2d2d2d;
  border-left: 3px solid #4ade80;
  border-radius: 4px;
}

.event-item.error {
  border-left-color: #f87171;
}

.event-header {
  display: flex;
  gap: 8px;
  align-items: center;
  margin-bottom: 6px;
}

.event-time {
  color: #888;
  font-size: 11px;
}

.event-status {
  font-size: 14px;
}

.event-type {
  color: #60a5fa;
  font-weight: 600;
  flex: 1;
}

.event-duration {
  color: #a78bfa;
  font-size: 11px;
}

.event-details {
  font-size: 11px;
  line-height: 1.5;
}

.event-request {
  color: #fbbf24;
}

.event-response {
  color: #4ade80;
}

.event-error {
  color: #f87171;
}

/* Scrollbar */
.console-events::-webkit-scrollbar {
  width: 8px;
}

.console-events::-webkit-scrollbar-track {
  background: #1e1e1e;
}

.console-events::-webkit-scrollbar-thumb {
  background: #4e4e4e;
  border-radius: 4px;
}

.console-events::-webkit-scrollbar-thumb:hover {
  background: #5e5e5e;
}
```

---

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–û–±–Ω–æ–≤–∏—Ç—å `/frontend/src/App.js`:**

```javascript
import React, { useState } from 'react';
import DebugConsole from './components/DebugConsole/DebugConsole';

function App() {
  const [isDebugOpen, setIsDebugOpen] = useState(false);

  return (
    <div className="App">
      {/* –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ */}
      
      {/* –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–æ–Ω—Å–æ–ª–∏ */}
      <button 
        className="debug-toggle"
        onClick={() => setIsDebugOpen(!isDebugOpen)}
        title="Debug Console"
      >
        üîç
      </button>

      {/* Debug Console */}
      <DebugConsole 
        isOpen={isDebugOpen} 
        onClose={() => setIsDebugOpen(false)} 
      />
    </div>
  );
}
```

**–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤ `App.css`:**

```css
.debug-toggle {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: #667eea;
  border: none;
  font-size: 24px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  z-index: 9999;
  transition: all 0.3s;
}

.debug-toggle:hover {
  background: #764ba2;
  transform: scale(1.1);
}
```

---

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
2. **–ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É üîç** –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É
3. **–ö–æ–Ω—Å–æ–ª—å –æ—Ç–∫—Ä–æ–µ—Ç—Å—è** –∏ –Ω–∞—á–Ω–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ API –∑–∞–ø—Ä–æ—Å—ã
4. **–í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏—è** –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (–∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–ø—Ü–∏–æ–Ω—ã, –∏ —Ç.–¥.)
5. **–ù–∞–±–ª—é–¥–∞—Ç—å** –∑–∞ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

**–¢–µ—Å—Ç 1: –ó–∞–≥—Ä—É–∑–∫–∞ —Ü–µ–Ω—ã –∞–∫—Ü–∏–∏**
```
10:15:23 ‚úÖ GET_STOCK_PRICE
         ‚Üí {"ticker": "SPY"}
         ‚Üê {"price": 459.80, "change": 2.30} (120ms)
```

**–¢–µ—Å—Ç 2: –ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø—Ü–∏–æ–Ω–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏**
```
10:15:25 ‚úÖ GET_OPTIONS_CHAIN
         ‚Üí {"ticker": "SPY", "expiration_date": "2025-10-31"}
         ‚Üê 156 contracts loaded (1.2s, 45KB)
```

**–¢–µ—Å—Ç 3: –û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏**
```
10:15:26 ‚ùå GET_GREEKS
         ‚Üí {"contract_id": "SPY251031C00450000"}
         ‚úó Error: No market data subscription (500ms)
```

---

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–í–∏–∑—É–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –≤–∏–¥–Ω–æ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏  
‚úÖ **–ë—ã—Å—Ç—Ä–∞—è –æ—Ç–ª–∞–¥–∫–∞** - —Å—Ä–∞–∑—É –≤–∏–¥–Ω–æ –≥–¥–µ –æ—à–∏–±–∫–∞  
‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏  
‚úÖ **–≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤** - –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞  
‚úÖ **–§–∏–ª—å—Ç—Ä—ã** - –ª–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è  
‚úÖ **–ù–µ —Ç—Ä–µ–±—É–µ—Ç –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞** - —É–¥–æ–±–Ω—ã–π UI  

---

## üöÄ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏—á–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. **WebSocket –¥–ª—è real-time**
–í–º–µ—Å—Ç–æ polling –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã ‚Üí WebSocket –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### 2. **–ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

### 3. **–ê–ª–µ—Ä—Ç—ã**
–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∏–ª–∏ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

### 4. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Polygon**
Side-by-side —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö IB vs Polygon

### 5. **Replay —Ä–µ–∂–∏–º**
–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å `api_logger.py`
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –≤ `ib_client.py`
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å API endpoints `/api/debug/*`
4. ‚úÖ –°–æ–∑–¥–∞—Ç—å React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `DebugConsole`
5. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `App.js`
6. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ Paper Account

**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: 4-6 —á–∞—Å–æ–≤**

---

–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–∏–ª—å–Ω–æ —É–ø—Ä–æ—Å—Ç–∏—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫—É –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å IB API! üéâ
