# –ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ AI-–º–æ–¥–µ–ª–∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (IV)

## 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Backend (Python/FastAPI)

### 1.1 –§–∞–π–ª—ã –º–æ–¥–µ–ª–∏
*   **–î–µ–π—Å—Ç–≤–∏–µ:** –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ñ–∞–π–ª—ã –º–æ–¥–µ–ª–∏ –≤ —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –±—ç–∫–µ–Ω–¥–∞.
*   **–û—Ç–∫—É–¥–∞:**
    *   `MODEL/options_model.onnx`
    *   `MODEL/options_model.onnx.data`
*   **–ö—É–¥–∞:** `backend/app/ai_models/` (—Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É).

### 1.2 –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
*   **–î–µ–π—Å—Ç–≤–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å ONNX.
*   **–ö–æ–º–∞–Ω–¥–∞:** `pip install onnxruntime numpy`
*   **–§–∞–π–ª:** –û–±–Ω–æ–≤–∏—Ç—å `backend/requirements.txt` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è).

### 1.3 –°–µ—Ä–≤–∏—Å (AI Engine)
*   **–§–∞–π–ª:** `backend/app/services/ai_prediction_service.py`
*   **–ö–ª–∞—Å—Å:** `AIPredictionService`
*   **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
    *   –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Å—Å–∏–∏ ONNX (Singleton –ø–∞—Ç—Ç–µ—Ä–Ω).
    *   –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (Scaling) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –∏–∑ –≥–∞–π–¥–∞.
    *   –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
    *   –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ fallback (–≤–æ–∑–≤—Ä–∞—Ç —Ç–µ–∫—É—â–µ–π IV, –µ—Å–ª–∏ –º–æ–¥–µ–ª—å —É–ø–∞–ª–∞).

### 1.4 API Endpoint
*   **–§–∞–π–ª:** `backend/app/routers/ai_prediction.py`
*   **Endpoint:** `POST /api/ai/predict-iv`
*   **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:** –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–æ—É—Ç–µ—Ä –≤ `backend/app/main.py`.

---

## 2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Frontend (React)

### 2.1 API –ö–ª–∏–µ–Ω—Ç
*   **–§–∞–π–ª:** `frontend/src/services/aiService.js` (–∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π api client).
*   **–§—É–Ω–∫—Ü–∏—è:** `predictIV(ticker, type, stockPrice, strike, ttm, currentIv)`.

### 2.2 –°–æ—Å—Ç–æ—è–Ω–∏–µ (State Management)
*   **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** `OptionsBoard.jsx` (–æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç).
*   **–ù–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
    *   `isAIEnabled` (Boolean, default: `true`).
    *   `aiVolatilityMap` (Map/Object) ‚Äî –∫—ç—à –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π `key: ticker_strike_date => iv`.

### 2.3 –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫
*   **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** `CalculatorSettings.jsx`.
*   **–≠–ª–µ–º–µ–Ω—Ç:** Toggle Switch "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ò–ò –º–æ–¥–µ–ª—å".
*   **–î–µ–π—Å—Ç–≤–∏–µ:** –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç `isAIEnabled`.

### 2.4 –õ–æ–≥–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ (Data Fetching)
*   **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** `PriceAndTimeSettings.jsx` (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è).
*   **–õ–æ–≥–∏–∫–∞:**
    *   –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `Target Price` –∏–ª–∏ `Target Date`:
        *   –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `isAIEnabled`.
        *   –ï—Å–ª–∏ `true` –∏ —Ç–∏–∫–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è ‚Äî –∑–∞–ø—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ —É –±—ç–∫–µ–Ω–¥–∞.
        *   –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–µ–π—Ç `calculationVolatility`.

### 2.5 –ò–Ω–¥–∏–∫–∞—Ü–∏—è
*   **–ú–µ—Å—Ç–æ:** –†—è–¥–æ–º —Å –≤—ã–±–æ—Ä–æ–º —Ç–∏–∫–µ—Ä–∞.
*   **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä:**
    *   üü£ (–§–∏–æ–ª–µ—Ç–æ–≤—ã–π) ‚Äî AI –≤–∫–ª—é—á–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Ç–∏–∫–µ—Ä–∞.
    *   ‚ö´Ô∏è (–ß–µ—Ä–Ω—ã–π/–°–µ—Ä—ã–π) ‚Äî AI –≤—ã–∫–ª—é—á–µ–Ω –∏–ª–∏ —Ç–∏–∫–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.

### 2.6 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Ä–∞—Å—á–µ—Ç—ã
–û–±–Ω–æ–≤–∏—Ç—å –≤—ã–∑–æ–≤—ã `calculateOptionPLValue` –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö, –ø–µ—Ä–µ–¥–∞–≤–∞—è –∏–º `aiVolatility` –≤–º–µ—Å—Ç–æ `null` (–∏–ª–∏ —Ç–µ–∫—É—â–µ–π IV):

1.  **OptionsTable.jsx** ‚Äî –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ø–æ–∑–∏—Ü–∏–π.
2.  **PLChart.jsx** ‚Äî –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ P&L.
3.  **utils/metricsCalculator.js** ‚Äî –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ì—Ä–µ–∫–æ–≤ –∏ P&L –ø–æ—Ä—Ç—Ñ–µ–ª—è.
4.  **ExitTimeDecayChart.jsx** ‚Äî –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä–∞—Å–ø–∞–¥–∞.
5.  **MagicSelection/magicSelectionLogic.js** ‚Äî –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π.
6.  **hooks/usePositionExitCalculator.js** ‚Äî –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –≤—ã—Ö–æ–¥–∞.

---

## 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –í–∞–ª–∏–¥–∞—Ü–∏—è

1.  **Smoke Test:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –±—ç–∫–µ–Ω–¥, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å (`onnxruntime`).
2.  **API Test:** –°–¥–µ–ª–∞—Ç—å CURL –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/ai/predict-iv` —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
3.  **E2E Test (AAPL):**
    *   –í—ã–±—Ä–∞—Ç—å AAPL.
    *   –í–∫–ª—é—á–∏—Ç—å AI.
    *   –ò–∑–º–µ–Ω–∏—Ç—å Target Price.
    *   –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ P&L –ø–µ—Ä–µ—Å—á–∏—Ç–∞–ª—Å—è —Å –Ω–æ–≤–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å—é (–æ—Ç–ª–∏—á–Ω–æ–π –æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π).
4.  **Fallback Test:** –í—ã–±—Ä–∞—Ç—å –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–∫–µ—Ä (PLTR), —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ—à–∏–±–æ–∫ –Ω–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è IV.
