# Обновление функционала "Рейтинг криптовалют"

## Дата: 24.11.2025

## Что добавлено

### 1. ✅ Информация об активной задаче мониторинга

Теперь рядом с кнопкой "Запустить мониторинг" отображается информационный блок с параметрами текущей активной задачи.

**Отображаемая информация:**
- День недели запуска
- Время запуска (New York)
- Интервал между снимками
- Дата и время следующего снимка
- **Статус операций** (что выполнено, что ожидается)

**Зачем это нужно:**
Пользователь сразу видит, что мониторинг уже запущен и не нужно нажимать кнопку повторно, если не требуется изменить параметры.

### 3. ✅ Статус выполнения операций

Добавлена секция "Статус операций" с визуальными индикаторами:

**Возможные статусы:**
- 🟡 **Ожидается первый снимок** - задача создана, ждем указанного времени
- 🟢 **Первый снимок создан** - первый снимок выполнен, показана дата
- 🟡 **Ожидается второй снимок** - ждем второго снимка через интервал
- После второго снимка автоматически создается анализ

**Визуальные элементы:**
- Зеленая точка ● - операция выполнена
- Желтая пульсирующая точка ● - операция ожидается
- Даты и время выполнения/ожидания

### 2. ✅ Уточнение часового пояса

В лейбле поля "Время" добавлено указание часового пояса: **"Время (New York)"**

## Технические изменения

### Frontend (`frontend/src/pages/CryptoRating.jsx`)

1. **Новое состояние:**
   ```javascript
   const [activeTask, setActiveTask] = useState(null);
   ```

2. **Новая функция загрузки:**
   ```javascript
   const fetchActiveTask = async () => {
     // Загружает информацию об активной задаче с сервера
   }
   ```

3. **Функции форматирования:**
   - `formatDayOfWeek(day)` - форматирует день недели на русском
   - `formatInterval(value, unit)` - форматирует интервал с правильным склонением

4. **UI блок информации:**
   - Синий информационный блок с иконкой часов
   - Отображается только если есть активная задача
   - Показывает все параметры задачи

### Backend (`backend/app/routers/crypto_rating.py`)

1. **Новый эндпоинт:**
   ```python
   @router.get("/active-task", response_model=TaskInfo)
   async def get_active_task(db: Session = Depends(get_db))
   ```

2. **Логика:**
   - Ищет активную задачу в БД (`is_active = True`)
   - Возвращает последнюю созданную активную задачу
   - Возвращает 404 если активных задач нет

## Как это работает

1. **При загрузке страницы:**
   - Загружается список анализов
   - Загружается информация об активной задаче

2. **При создании новой задачи:**
   - Задача создается на сервере
   - Автоматически обновляется информация об активной задаче
   - Информационный блок появляется рядом с кнопкой

3. **Если активной задачи нет:**
   - Информационный блок не отображается
   - Пользователь может создать новую задачу

## Пример отображения

```
┌─────────────────────────────────────────────────────────────────────┐
│ [▶ Запустить мониторинг]  [🕐 Активный мониторинг               ]  │
│                            │ Понедельник в 10:00 (New York),      │
│                            │ интервал: 24 часа                    │
│                            │ Следующий снимок: 25.11.2025 10:00  │
│                            │ ─────────────────────────────────    │
│                            │ Статус операций:                     │
│                            │ ● Первый снимок создан: 24.11 10:00  │
│                            │ ● Ожидается второй снимок: 25.11 10:00│
└─────────────────────────────────────────────────────────────────────┘
```

**Легенда:**
- ● (зеленая) - операция выполнена
- ● (желтая, пульсирует) - операция ожидается

## Преимущества

✅ **Прозрачность** - пользователь всегда видит текущие настройки  
✅ **Предотвращение дублирования** - понятно, что задача уже запущена  
✅ **Информативность** - видно когда будет следующий снимок  
✅ **Отслеживание прогресса** - понятно какие операции выполнены, какие ожидаются  
✅ **Визуальная обратная связь** - цветные индикаторы и анимация  
✅ **UX** - не нужно искать информацию в других местах

---

**Статус:** ✅ Реализовано и готово к использованию  
**Требуется перезапуск:** Backend (для нового эндпоинта)
