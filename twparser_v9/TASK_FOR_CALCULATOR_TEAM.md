# –ó–∞–¥–∞—á–∞ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º TradingView Parser v9

## –¶–µ–ª—å

–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–Ω–æ–ø–∫—É **"–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ü–µ–ø–æ—á–∫—É –æ–ø—Ü–∏–æ–Ω–æ–≤"**, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Chrome-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ.

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

```
–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä                    –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ                    TradingView
     ‚îÇ                              ‚îÇ                              ‚îÇ
     ‚îÇ  1. –ó–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–∞–Ω–¥—É         ‚îÇ                              ‚îÇ
     ‚îÇ  –≤ localStorage              ‚îÇ                              ‚îÇ
     ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>                              ‚îÇ
     ‚îÇ                              ‚îÇ                              ‚îÇ
     ‚îÇ                              ‚îÇ  2. –û—Ç–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É          ‚îÇ
     ‚îÇ                              ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>
     ‚îÇ                              ‚îÇ                              ‚îÇ
     ‚îÇ                              ‚îÇ  3. –°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ           ‚îÇ
     ‚îÇ                              ‚îÇ <‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
     ‚îÇ                              ‚îÇ                              ‚îÇ
     ‚îÇ  4. –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ          ‚îÇ                              ‚îÇ
     ‚îÇ  –∏–∑ localStorage             ‚îÇ                              ‚îÇ
     ‚îÇ <‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                              ‚îÇ
     ‚îÇ                              ‚îÇ                              ‚îÇ
```

---

## –®–∞–≥ 1: –ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É, –∑–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ `localStorage`:

```typescript
function startOptionsChainCollection(ticker: string) {
  // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∫–æ–º–∞–Ω–¥—É –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
  localStorage.setItem('tvc_command', JSON.stringify({
    action: 'collectFullChain',
    ticker: ticker,              // –ù–∞–ø—Ä–∏–º–µ—Ä: 'ESM2026', 'ESH2026'
    maxExpirations: 10,          // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å–∫–æ–ª—å–∫–æ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–π —Å–æ–±—Ä–∞—Ç—å (1-20)
    timestamp: Date.now()        // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ: –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
  }));
}
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥—ã:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| `action` | `'collectFullChain'` | ‚úÖ | –¢–∏–ø –∫–æ–º–∞–Ω–¥—ã |
| `ticker` | `string` | ‚úÖ | –¢–∏–∫–µ—Ä –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞: `'ESM2026'`, `'ESH2026'` |
| `maxExpirations` | `number` | ‚ùå | –õ–∏–º–∏—Ç —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5, –º–∞–∫—Å 20) |
| `timestamp` | `number` | ‚úÖ | `Date.now()` |

---

## –®–∞–≥ 2: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ `localStorage.tvc_status`:

```typescript
interface TVCStatus {
  status: 'idle' | 'collecting' | 'completed' | 'error';
  progress: number;              // 0-100
  currentExpiration: string;     // "Mar 20"
  totalExpirations: number;      // 5
  collectedExpirations: number;  // 2
  totalOptions: number;          // 40
  error: string | null;          // –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
  timestamp: number;             // Date.now()
}

// –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
useEffect(() => {
  const handleStorage = (e: StorageEvent) => {
    if (e.key === 'tvc_status' && e.newValue) {
      const status: TVCStatus = JSON.parse(e.newValue);
      setCollectionStatus(status);
    }
  };
  
  window.addEventListener('storage', handleStorage);
  return () => window.removeEventListener('storage', handleStorage);
}, []);
```

---

## –®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ `localStorage.tvc_full_chain`:

```typescript
interface TVCFullChain {
  collectedAt: string;           // ISO timestamp
  ticker: string;                // "ESM2026"
  expirations: TVCExpiration[];
}

interface TVCExpiration {
  date: string;                  // "Mar 20"
  dateCode: string;              // "20260320"
  options: TVCOption[];
}

interface TVCOption {
  type: 'CALL' | 'PUT';
  strike: number;                // 6950
  expiration: string;            // "Mar 20"
  expirationISO: string;         // "2026-03-20"
  bid: number;                   // 224.5
  ask: number;                   // 226.0
  price: number;                 // 225.25
  volume: number;                // 1234
  iv: number;                    // 14.1 (–ø—Ä–æ—Ü–µ–Ω—Ç)
  delta: number;                 // 0.61
  gamma: number;                 // 0.0009
  theta: number;                 // -1.29
  vega: number;                  // 11.24
  rho: number;                   // 7.08
}

// –°–ª—É—à–∞–µ–º –¥–∞–Ω–Ω—ã–µ
useEffect(() => {
  const handleStorage = (e: StorageEvent) => {
    if (e.key === 'tvc_full_chain' && e.newValue) {
      const data: TVCFullChain = JSON.parse(e.newValue);
      setOptionsChainData(data);
    }
  };
  
  window.addEventListener('storage', handleStorage);
  return () => window.removeEventListener('storage', handleStorage);
}, []);
```

---

## –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

```tsx
import { useState, useEffect } from 'react';

interface TVCStatus {
  status: 'idle' | 'collecting' | 'completed' | 'error';
  progress: number;
  currentExpiration: string;
  totalExpirations: number;
  collectedExpirations: number;
  totalOptions: number;
  error: string | null;
  timestamp: number;
}

interface TVCFullChain {
  collectedAt: string;
  ticker: string;
  expirations: {
    date: string;
    dateCode: string;
    options: {
      type: 'CALL' | 'PUT';
      strike: number;
      bid: number;
      ask: number;
      iv: number;
      delta: number;
      gamma: number;
      theta: number;
      vega: number;
    }[];
  }[];
}

export function OptionsChainLoader({ ticker }: { ticker: string }) {
  const [status, setStatus] = useState<TVCStatus | null>(null);
  const [chainData, setChainData] = useState<TVCFullChain | null>(null);
  const [isLoading, setIsLoading] = useState(false);

  // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è localStorage
  useEffect(() => {
    const handleStorage = (e: StorageEvent) => {
      if (e.key === 'tvc_status' && e.newValue) {
        const data = JSON.parse(e.newValue);
        setStatus(data);
        setIsLoading(data.status === 'collecting');
      }
      
      if (e.key === 'tvc_full_chain' && e.newValue) {
        const data = JSON.parse(e.newValue);
        setChainData(data);
        setIsLoading(false);
      }
    };

    window.addEventListener('storage', handleStorage);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    const existingData = localStorage.getItem('tvc_full_chain');
    if (existingData) {
      setChainData(JSON.parse(existingData));
    }
    
    return () => window.removeEventListener('storage', handleStorage);
  }, []);

  // –ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∞
  const startCollection = () => {
    setIsLoading(true);
    setStatus(null);
    
    localStorage.setItem('tvc_command', JSON.stringify({
      action: 'collectFullChain',
      ticker: ticker,
      maxExpirations: 10,
      timestamp: Date.now()
    }));
  };

  // –ü–æ–¥—Å—á—ë—Ç –æ–ø—Ü–∏–æ–Ω–æ–≤
  const totalOptions = chainData?.expirations.reduce(
    (sum, exp) => sum + exp.options.length, 0
  ) || 0;

  return (
    <div className="options-chain-loader">
      {/* –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ */}
      {!isLoading && (
        <button 
          onClick={startCollection}
          className="btn-primary"
          disabled={!ticker}
        >
          üìä –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ü–µ–ø–æ—á–∫—É –æ–ø—Ü–∏–æ–Ω–æ–≤
        </button>
      )}

      {/* –ü—Ä–æ–≥—Ä–µ—Å—Å */}
      {isLoading && status && (
        <div className="progress-container">
          <div 
            className="progress-bar" 
            style={{ width: `${status.progress}%` }}
          />
          <span className="progress-text">
            {status.currentExpiration} ({status.collectedExpirations}/{status.totalExpirations})
          </span>
          <span className="progress-options">
            {status.totalOptions} –æ–ø—Ü–∏–æ–Ω–æ–≤
          </span>
        </div>
      )}

      {/* –û—à–∏–±–∫–∞ */}
      {status?.status === 'error' && (
        <div className="error-message">
          ‚ö†Ô∏è {status.error}
          <button onClick={startCollection}>–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
        </div>
      )}

      {/* –†–µ–∑—É–ª—å—Ç–∞—Ç */}
      {chainData && !isLoading && (
        <div className="chain-info">
          ‚úÖ {chainData.ticker}: {chainData.expirations.length} —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–π, {totalOptions} –æ–ø—Ü–∏–æ–Ω–æ–≤
          <span className="collected-at">
            {new Date(chainData.collectedAt).toLocaleString()}
          </span>
        </div>
      )}
    </div>
  );
}
```

---

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è
–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—É **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ** —á–µ—Ä–µ–∑ `StorageEvent` ‚Äî –Ω–µ –Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å polling.

### 2. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
–ï—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ localStorage. –ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:

```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
const isExtensionInstalled = () => {
  // –ï—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –æ–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç tvc_status
  const status = localStorage.getItem('tvc_status');
  if (status) {
    const data = JSON.parse(status);
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–≤–µ–∂–∏–µ (–º–µ–Ω–µ–µ 5 –º–∏–Ω—É—Ç)
    return Date.now() - data.timestamp < 5 * 60 * 1000;
  }
  return false;
};
```

### 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –≤–∫–ª–∞–¥–∫–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (`localhost:3000` –∏–ª–∏ `futures.optioner.online`).

### 3. Cooldown –º–µ–∂–¥—É —Å–±–æ—Ä–∞–º–∏
–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏–º–µ–µ—Ç cooldown 30 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É —Å–±–æ—Ä–∞–º–∏. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–º—ë—Ç –∫–Ω–æ–ø–∫—É —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ, —Å–±–æ—Ä –Ω–µ –Ω–∞—á–Ω—ë—Ç—Å—è.

### 4. –õ–∏–º–∏—Ç —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–π
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è 5 —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–π. –ú–∞–∫—Å–∏–º—É–º ‚Äî 20. –ë–æ–ª—å—à–µ = –¥–æ–ª—å—à–µ –∏ –≤—ã—à–µ —Ä–∏—Å–∫ –±–∞–Ω–∞.

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –£—Å—Ç–∞–Ω–æ–≤–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏–∑ –ø–∞–ø–∫–∏ `twparser_v9`
2. –û—Ç–∫—Ä–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
3. –í –∫–æ–Ω—Å–æ–ª–∏ –≤—ã–ø–æ–ª–Ω–∏:
```javascript
localStorage.setItem('tvc_command', JSON.stringify({
  action: 'collectFullChain',
  ticker: 'ESM2026',
  maxExpirations: 3,
  timestamp: Date.now()
}));
```
4. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ—Ç–∫—Ä–æ–µ—Ç TradingView –∏ –Ω–∞—á–Ω—ë—Ç —Å–±–æ—Ä
5. –ß–µ—Ä–µ–∑ ~15-30 —Å–µ–∫ –¥–∞–Ω–Ω—ã–µ –ø–æ—è–≤—è—Ç—Å—è –≤ `localStorage.tvc_full_chain`

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–í–æ–ø—Ä–æ—Å—ã –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ‚Üí –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –∫–æ–º–∞–Ω–¥–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.
