name: Check File Size Limit

on:
  pull_request:
    branches: [ main, develop ]
  push:
    branches: [ main, develop ]

jobs:
  check-file-size:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
      
    - name: Check file line count
      run: |
        echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ (–º–∞–∫—Å 300 —Å—Ç—Ä–æ–∫)..."
        
        # –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ JS/JSX/TS/TSX —Ñ–∞–π–ª—ã
        FILES=$(find . -type f \( -name "*.js" -o -name "*.jsx" -o -name "*.ts" -o -name "*.tsx" \) \
          ! -path "*/node_modules/*" \
          ! -path "*/build/*" \
          ! -path "*/dist/*" \
          ! -path "*/.next/*" \
          ! -path "*/venv/*" \
          ! -path "*/.venv/*" \
          ! -name "*.config.js" \
          ! -name "*.config.ts" \
          ! -name "tailwind.config.js" \
          ! -name "postcss.config.js")
        
        VIOLATIONS=0
        
        for file in $FILES; do
          LINES=$(wc -l < "$file")
          if [ $LINES -gt 300 ]; then
            EXCESS=$((LINES - 300))
            PERCENT=$(( (EXCESS * 100) / 300 ))
            echo "‚ùå $file: $LINES —Å—Ç—Ä–æ–∫ (–ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ: +$EXCESS —Å—Ç—Ä–æ–∫, +$PERCENT%)"
            VIOLATIONS=$((VIOLATIONS + 1))
          fi
        done
        
        if [ $VIOLATIONS -gt 0 ]; then
          echo ""
          echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
          echo "‚ùå –ù–∞–π–¥–µ–Ω–æ $VIOLATIONS —Ñ–∞–π–ª(–æ–≤) –ø—Ä–µ–≤—ã—à–∞—é—â–∏—Ö 300 —Å—Ç—Ä–æ–∫"
          echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
          echo ""
          echo "üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:"
          echo "   –°–º. docs/MODULAR_CODE_METHODOLOGY.md"
          exit 1
        fi
        
        echo "‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ª–∏–º–∏—Ç—É 300 —Å—Ç—Ä–æ–∫"

    - name: Report results
      if: failure()
      run: |
        echo "::error::–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–µ–≤—ã—à–∞—é—Ç –ª–∏–º–∏—Ç –≤ 300 —Å—Ç—Ä–æ–∫. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ–¥–∏—Ç–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥."
