# Анализ функционала "Волшебной кнопки" (Magic Button)

## Обзор
"Волшебная кнопка" (Magic Button) расположена в заголовке таблицы опционов на странице "Калькулятор опционов". Она представляет собой иконку "волшебной палочки" (Sparkles).

**Назначение**: Автоматический подбор оптимальных опционов для хеджирования (защиты) позиции базового актива и повышения доходности.

## Техническая реализация
- **Компонент кнопки**: `MagicButton` внутри `OptionsTable.jsx`.
- **Компонент модального окна**: `MagicSelectionModal.jsx` (в папке `src/components/CalculatorV2/MagicSelection/`).
- **Бизнес-логика**: `magicSelectionLogic.js`.

## Принцип действия
Функционал работает по сценарному принципу, анализируя текущий портфель пользователя:

### Сценарий 1: Нет позиции базового актива
Если в калькуляторе не добавлена позиция по базовому активу (акции/фьючерсу), система сообщает, что для "волшебства" необходима позиция.
* **Действие**: Пользователь должен добавить позицию.

### Сценарий 2: Подбор защиты (Protective Put)
Если есть позиция базового актива, но нет защитного опциона PUT.
* **Цель**: Найти лучший опцион **Buy PUT**.
* **Параметры по умолчанию**:
    * Диапазон страйков: ±20% от текущей цены.
    * Уровни риска: ±5% от цены.
    * Минимальный Open Interest: 100 (фильтр ликвидности).
    * Макс. дней до экспирации: 100.
* **Результат**: Предлагает опцион, который ограничивает убыток при падении цены, при этом имеет приемлемую премию.

### Сценарий 3: Компенсация / Усиление (Recovery Call)
Если есть и позиция базового актива, и защитный PUT.
* **Цель**: Найти лучший опцион **Buy CALL**.
* **Назначение**: Компенсировать затраты на покупку PUT опциона или создать возможность заработка при росте.
* **Анализ**: Рассчитывает сценарий, чтобы прибыль от CALL перекрывала возможные убытки.

### Сценарий 4: Готово
Если в портфеле уже присутствуют и Buy PUT, и Buy CALL опционы, кнопка считается отработавшей свой сценарий.

## Особенности
* **Фильтр ликвидности**: Система отсеивает неликвидные опционы (с низким Open Interest), чтобы избежать проблем с входом/выходом. Если найден хороший опцион с низкой ликвидностью, он может быть предложен как "Alert" (Предложение), но с предупреждением.
* **Учет рисков**: При подборе рассчитывается P&L (Profit & Loss) на заданных уровнях цены (UP/DOWN) и день выхода (Evaluation Day).
* **Интерфейс**: Модальное окно позволяет пользователю корректировать параметры подбора (уровни цен, риски, сроки) перед запуском поиска.
